CREATE OR REPLACE PROCEDURE agregar_venta(p_venta VENTA%ROWTYPE) IS
    v_precio_unitario PRODUCTO.PRECIO_UNITARIO%TYPE;
    v_total_venta NUMBER;
    v_subtotal FACTURA.SUBTOTAL%TYPE;
    v_iva FACTURA.IVA%TYPE;
    v_total_factura NUMBER;
BEGIN
    -- Obtener el precio unitario del producto
    SELECT PRECIO_UNITARIO INTO v_precio_unitario
    FROM PRODUCTO
    WHERE CODIGO = p_venta.CODIGO;

    -- Calcular el total de la venta
    v_total_venta := p_venta.CANTIDAD * v_precio_unitario;

    -- Obtener el subtotal y el IVA de la factura
    SELECT SUBTOTAL, IVA INTO v_subtotal, v_iva
    FROM FACTURA
    WHERE NUMERO = p_venta.NUMERO;

    -- Calcular el nuevo subtotal y el total de la factura
    v_subtotal := v_subtotal + v_total_venta;
    v_total_factura := v_subtotal + v_iva;

    -- Actualizar el subtotal y el total de la factura
    UPDATE FACTURA
    SET SUBTOTAL = v_subtotal,
        TOTAL = v_total_factura
    WHERE NUMERO = p_venta.NUMERO;

    -- Actualizar el total de la venta
    UPDATE VENTA
    SET TOTAL = v_total_venta
    WHERE ID = p_venta.ID;
END agregar_venta;